<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>test codemirror</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/codemirror.css"
    />
    <!-- <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/hint/show-hint.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/fold/foldgutter.css"
      rel="external nofollow"
    /> -->

    <style>
      html,
      body {
        padding: 0;
        margin: 0;
        font-family: PingFangSC-Regular, -apple-system, BlinkMacSystemFont,
          Helvetica Neue, Arial, PingFang SC, Hiragino Sans GB, STHeiti,
          Microsoft YaHei, Microsoft JhengHei, Source Han Sans SC,
          Noto Sans CJK SC, Source Han Sans CN, Noto Sans SC, Source Han Sans TC,
          Noto Sans CJK TC, WenQuanYi Micro Hei, SimSun, sans-serif;
        min-height: 100vh;
        overflow: hidden;
      }
      textarea {
        position: absolute;
        width: 100%;
        height: 100%;
        resize: none;
        left: 0;
        top: 0;
        padding: 20px;
        margin: 0;
        border: 0;
        box-sizing: border-box;
      }
      textarea:active,
      textarea:hover,
      textarea:focus {
        outline: none;
      }

      .cm-trailingspace {
        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAYAAAB/qH1jAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QUXCToH00Y1UgAAACFJREFUCNdjPMDBUc/AwNDAAAFMTAwMDA0OP34wQgX/AQBYgwYEx4f9lQAAAABJRU5ErkJggg==);
        background-position: bottom left;
        background-repeat: repeat-x;
      }
    </style>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div style="width: 100%; min-height: 100vh;">
      <div
        style="height: 100vh;display: -webkit-flex;display: flex;-webkit-flex-direction: column;flex-direction: column;"
      >
        <div
          style="height: 100%;width: 100%;position: absolute;top: 0;left: 0;overflow: hidden;"
        >
          <textarea name="" id="test"></textarea>
        </div>
      </div>
    </div>

    <script src="https://cdn.bootcss.com/lodash.js/4.17.11/lodash.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/codemirror.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/mode/swift/swift.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/hint/show-hint.js"></script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/edit/closebrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/edit/matchbrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/keymap/sublime.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/edit/trailingspace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/search/jump-to-line.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/dialog/dialog.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/search/search.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/selection/active-line.js"></script>

    <!-- 折叠 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/fold/foldcode.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/fold/foldgutter.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/fold/brace-fold.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/fold/comment-fold.js"></script>

    <script src="./test/libs/formatting.js"></script>

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/search/match-highlighter.js"></script> -->

    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/mode/javascript/javascript.js"></script> -->
    <!-- <script src="./test/hint/javascript-hint.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.45.0/addon/hint/anyword-hint.js"></script> -->

    <script>
      console.log([CodeMirror]);

      var testTxt = (function() {
        return `var str = "Hello, World!"

print(str)

// 变量用var声明，常量用let声明，变量类型自动推断
// 可在变量后声明类型，用冒号分隔
var myVariable = 42
let myConstant = 42
myVariable = 50
let explictDouble: Double = 60

// 值永远不会被隐式转换为其他类型，需要转换必须采用显式转换
let label = "The width is "
let width = 94
let widthLabel = label + String(width)

// 更为常见的将值转换为字符串的方法
let apples = 3
let oranges = 5
let appleSummary = "I have \(apples) apples"
let fruitSummary = "I have \(apples + oranges) pieces of fruit"

// []用来创建数组或字典
var shoppingList = ["catfish", "water", "tulips", "blue paint"]
shoppingList[1]  = "bottle of water"

var occupations = [
    "Malcolm": "Captain",
    "Kaylee": "Mechanic"
]
occupations["Jayne"] = "Public Relations"

// 创建一个空数组或者字典
let emptyArray1 = [String]()
let emptyDictionary1 = [String: Float]()
let emptyArray2: [String] = []
let emptyDictionary2: [String: Float] = [:]

// 控制流，if和switch用于选择，for-in,for,while和repeat-while用于循环
let individualScores = [75, 43, 103, 87, 12]
var teamScore = 0
for score in individualScores {
    if score > 50 {
        teamScore += 3
    } else {
        teamScore += 1
    }
}
print(teamScore)

// 由于不支持隐式转换，条件必须是一个布尔表达式
// 一般采用可选值配合if和let，处理值缺失判断
var optionalString: String? = "Hello"
print(optionalString == nil)
var optionalName: String? = "John Appleseed"
var greeting = "Hello"
if let name = optionalName {
    greeting = "Hello, \(name)"
}

// Switch支持任意类型的数据以及各种比较操作
let vegetable = "red pepper"

switch vegetable {
case "celery" :
    print("Add some raisins and make ants on a log")
case "cucumber", "watercress" :
    print("That woould make a good tea sandwich")
case let x where x.hasSuffix("pepper") :
    print("Is it a spicy \(x)?")
default :
    print("Everything tastes good in soup")
}

// 使用for-in遍历字典
let interestingNumbers = [
    "Prime": [2, 3, 5, 7, 11, 13],
    "Fibonacci": [1, 1, 2, 3, 5, 8],
    "Square": [1, 4, 9, 16, 25],
]
var largest = 0
var numberGroup: String = "Null"
for (kind, numbers) in interestingNumbers {
    for number in numbers {
        if number > largest {
            largest = number
            numberGroup = kind
        }
    }
}
print(numberGroup, largest)

// while循环
var n = 2
while n \< 100 {
    n = n * 2
}
print(n)

var m = 2
repeat {
    m = m * 2
} while m \< 100
print(m)

// 可以在循环中使用..\<来表示范围,包含上界使用...
var firstForLoop = 0
for i in 0..\<4 {
    firstForLoop += i
}
print(firstForLoop)

var secondForLoop = 0
for var i = 0; i \< 4; ++i {
    secondForLoop += i
}
print(secondForLoop)`;
      })();

      document.getElementById("test").value = testTxt;

      var editor = CodeMirror.fromTextArea(document.getElementById("test"), {
        lineNumbers: true,
        mode: "swift",
        matchBrackets: true,
        smartIndent: true,
        showCursorWhenSelecting: true,
        autoCloseBrackets: true,
        keyMap: "sublime",
        showTrailingSpace: true,
        styleActiveLine: true,
        lineWrapping: true, //代码折叠
        foldGutter: true,
        extraKeys: {
          "Cmd-S": function() {
            console.log(editor.getValue());
            console.log("--- ctrl + s =====");
          }
        }
        // highlightSelectionMatches: { showToken: /\w/, annotateScrollbar: true }
      });

      console.log(editor);
      editor.setSize("100%", "100%");

      editor.on(
        "change",
        _.debounce(function() {
          // editor.showHint();
        }, 600)
      );

      // editor.on("save", () => {
      //   console.log("-----save ====");
      // });

      // 格式化
      // setTimeout(() => {
      //   editor.autoFormatRange(
      //     editor.posFromIndex(0),
      //     editor.posFromIndex(editor.getValue())
      //   );
      // }, 1000);

      // editor.on("change", function() {
      //   //获取用户当前的编辑器中的编写的代码
      //   // var words = editor.getValue();
      //   // // 利用正则取出用户输入的所有的英文的字母
      //   // // words = words.replace(/[a-z]+[\-|\']+[a-z]+/gi, "").match(/([a-z]+)/gi);

      //   // words = words.split(/\s/);
      //   // //将获取到的用户的单词传入CodeMirror,并在javascript-hint中做匹配
      //   // const lastVal = (words.slice(-1)[0] || "").replace(/[\(\)\,\{\}]/g, "");
      //   // if (lastVal) {
      //   //   // CodeMirror.ukeys = lastVal;
      //   //   //调用显示提示

      //   // }

      //   editor.showHint();
      // });
    </script>
  </body>
</html>
